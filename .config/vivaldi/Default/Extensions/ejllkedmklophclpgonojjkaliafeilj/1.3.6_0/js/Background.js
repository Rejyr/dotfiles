var global="undefined"==typeof chrome?"undefined"==typeof browser?void 0:browser:chrome;NP={actionUrl:"http://web-paint.com/api/action/",uninstallUrl:"http://web-paint.com/uninstall/",config:{},queue:[],queueProcessorReady:!1,uid:"",version:chrome.runtime.getManifest().version,init:function(){global.browserAction.onClicked.addListener(this.inject),global.runtime.onMessage.addListener(function(b,c,d){if("take_screen_shot"===b.method)NP.screenShot(d);else if("get_pixel_color"===b.method){var e=b.point;NP.getPixelColor(e,d)}else"save_data"===b.method?NP.saveData(b.config):"get_data"===b.method?NP.getData(d):"open_options"===b.method&&chrome.runtime.openOptionsPage();return!0}),NP.initWebrequests(),NP.initStorage(),NP.initListeners()},getPixelColor:function(b,d){global.tabs.captureVisibleTab(null,null,function(a){var c=document.createElement("canvas"),f=c.getContext("2d"),g=new Image;document.documentElement.appendChild(c),g.src=a,g.onload=function(){c.width=g.naturalWidth,c.height=g.naturalHeight,f.drawImage(g,0,0);var h=f.getImageData(0,0,c.width,c.height),e=4*(b.y*h.width+b.x),i=h.data;if("function"==typeof d){var j={r:i[e],g:i[e+1],b:i[e+2],a:i[e+3]};document.documentElement.removeChild(c),d(j)}}})},saveData:function(a){try{localStorage.setItem("config",JSON.stringify(a))}catch(a){}},getData:function(a){var b=localStorage.getItem("config"),c=null;try{c=JSON.parse(b)}catch(a){}a(c)},initWebrequests:function(){global.webRequest.onHeadersReceived.addListener(({responseHeaders:a})=>{let b=[];return a.forEach(a=>{b.push(a)}),{responseHeaders:b}},{urls:["*://*/*"]},["blocking","responseHeaders"])},inject:function(){global.tabs.insertCSS(null,{file:"/css/main.min.css"},function(){if(global.extension.lastError){global.extension.lastError.message;try{alert("We are sorry, but the page you are viewing is not supported. Please try another page.")}catch(a){}}global.tabs.executeScript(null,{file:"/js/inject.js"})})},screenShot:function(b){global.tabs.captureVisibleTab(function(c){var a=global.extension.getURL("screen.html");global.tabs.query({},function(d){var e;if(d&&d.length)for(var f=d.length-1;0<=f;f--)if(d[f].url===a){e=d[f];break}e?global.tabs.update(e.id,{active:!0},Function.prototype.bind.call(NP.updateScreenshot,NP,c,b,0)):global.tabs.create({url:a},Function.prototype.bind.call(NP.updateScreenshot,NP,c,b,0))})})},updateScreenshot:function(b,c){var d=arguments[2];null==d&&(d=0),10<d||global.runtime.sendMessage({method:"update_url",url:b},function(a){a&&a.success||window.setTimeout(Function.prototype.bind.call(NP.updateScreenshot,NP,b,c,++d),300)})},processQueue:function(){for(;0<NP.queue.length;){var a=NP.queue.shift();if(!a.type||"action"!=a.type)return!0;var b="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:NP.version,action:a.action,uid:NP.uid,t:Date.now()})));fetch(NP.actionUrl+"?"+b).then(a=>a.json()).then(function(a){a.url&&chrome.tabs.create({url:a.url})})}},setUninstallUrl:function(){var a="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:NP.version,action:"uninstall",uid:NP.uid,t:Date.now()})));chrome.runtime.setUninstallURL(NP.uninstallUrl+"?"+a)},initListeners:function(){chrome.runtime.onInstalled.addListener(a=>{NP.queue.push({type:"action",action:a.reason}),NP.queueProcessorReady&&NP.processQueue()})},initStorage:function(){chrome.storage.local.get(a=>{a&&a.config&&(NP.config=a.config),NP.config.uid?NP.uid=NP.config.uid:(NP.uid=NP.config.uid=NP.generateUID(),this.saveConfig()),NP.queueProcessorReady=!0,NP.setUninstallUrl(),NP.processQueue()})},saveConfig(){chrome.storage.local.set({config:NP.config})},generateUID(){return"xxxxxxxx-xxxx-2xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}},NP.init();