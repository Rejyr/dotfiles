var injectButton=function(){const e=document.querySelector('[role="toolbar"]');if(!Array.from(e.childNodes).find(e=>e.classList.contains("kami-drive-viewer-toolstrip-mid-panel"))){var t=document.createElement("div");t.classList.add("kami-drive-viewer-toolstrip-mid-panel"),t.innerHTML='<div class="kami-drive-viewer-toolstrip-open-and-openwith"><a class="kami-drive-viewer-toolstrip-open" role="button" data-tooltip-unhoverable="true" data-tooltip-delay="500" data-tooltip-class="drive-viewer-jfk-tooltip" data-tooltip-align="b,c" data-tooltip-offset="-6" aria-hidden="false" aria-label="Open with Kami" style="user-select: none;" tabindex="0" data-tooltip="Open with Kami"><div class="kami-drive-viewer-open-app-icon"></div><div class="kami-drive-viewer-open-label">Open with Kami</div></a></div>',driveRightButtonsContainerLeftPosition=document.body.offsetWidth-document.querySelector(".ndfHFb-c4YZDc-Wrql6b-AeOLfc-b0t70b").getBoundingClientRect().left,t.style.margin=`4px ${driveRightButtonsContainerLeftPosition}px 0px auto`,e.children[0].appendChild(t),document.querySelector(".kami-drive-viewer-toolstrip-open").addEventListener("click",function(e){wrapWindowOpen();var t=document.querySelector(".ndfHFb-c4YZDc-z5C9Gb-LgbsSe"),n=document.createEvent("MouseEvents");n.initEvent("mousedown",!0,!0),t.dispatchEvent(n);const i=document.querySelector(".ndfHFb-c4YZDc-xl07Ob.ndfHFb-c4YZDc-xl07Ob-BvBYQ.ndfHFb-c4YZDc-s2gQvd.ndfHFb-c4YZDc-i5oIFb.ndfHFb-c4YZDc-z5C9Gb-xl07Ob");i&&(i.style.visibility="hidden"),setTimeout(function(){var e=document.querySelector(".ndfHFb-c4YZDc-j7LFlb-Bz112c.ndfHFb-c4YZDc-GSQQnc-LgbsSe").parentElement,t=e.getBoundingClientRect(),n=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!0,clientX:t.left+5,clientY:t.top+5,x:t.left+5,y:t.top+5});e.dispatchEvent(n)},10)})}};function googleStateFromOpenUrl(e,t){let n,i,a=new URL(e);if(a.searchParams.get("id")&&a.searchParams.get("id").match(/[A-z0-9-_]+/)&&(n=a.searchParams.get("id")),!n){const e=a.pathname.match(/\/d\/([A-z0-9-_]+)\/(view|edit)/);e&&(n=e[1])}if(!n)return;if(a.searchParams.get("authuser")&&a.searchParams.get("authuser").match(/\d+/)&&(i=a.searchParams.get("authuser")),!i){const e=window.location.href.match(/\/u\/(\d+)\//);e&&(i=e[1])}const o={ids:[n],from:t};return i&&(o.authuser=i),o}var wrapWindowOpenScript=function(){/\{\s*\[native code\]\s*\}/.test(""+window.open)&&(window.originalOpen=window.open),window.open=function(){window.open=window.originalOpen;const e=googleStateFromOpenUrl(arguments[0],"classroomopenext");e?(kamiURL="https://web.kamihq.com/web/viewer.html?state="+encodeURIComponent(JSON.stringify(e)),window.open(kamiURL,"_blank")):window.open.apply(this,arguments)};var e=document.currentScript;e&&null!==e.parentNode&&e.parentNode.removeChild(e)},wrapWindowOpen=function(){var e=document.head||document.documentElement;if(null===e)return!1;var t=document.createElement("script");t.textContent=googleStateFromOpenUrl.toString()+";("+wrapWindowOpenScript.toString()+")();";try{e.appendChild(t)}catch(e){}},previewOpenObserver=new MutationObserver(function(e){e.forEach(function(e){if(e.addedNodes)for(var t=0;t<e.addedNodes.length;t++){var n=e.addedNodes[t];n.attributes&&n.attributes["aria-label"]&&n.attributes.role&&"dialog"===n.attributes.role.value&&(injectButton(),previewOpenObserver.disconnect())}})}),fetchClassroomAlternateId=function(){var e=window.location.href.match(/https?:\/\/classroom\.google\.com.*\/[cw]\/([A-z0-9]+)/);return e&&e.length>1?e[1]:null},kamiCreateAssignmentButtonListener=function(e){console.log(e),document.body.click(),kamiURL=`https://web.kamihq.com/web/viewer.html?open_dialog=create_assignment&seamless_dialog=true&parent_origin=${encodeURIComponent(window.location.origin)}`;var t=fetchClassroomAlternateId();t&&(kamiURL+="&class_alternate_id="+t);var n=`<iframe src="${kamiURL}" seamless="" class="kami-create-assignment-iframe"></iframe>`;const i=document.createElement("div");i.innerHTML=n;var a=i.children[0];i.removeChild(a);var o=e=>{e.data&&"kami"===e.data.type&&"assignment_dialog_closed"===e.data.event&&(window.removeEventListener("message",o),document.body.removeChild(a))};window.addEventListener("message",o),document.body.appendChild(a)},fabMenuObserver=new MutationObserver(function(e){e.forEach(function(e){if(e.addedNodes)for(var t=0;t<e.addedNodes.length;t++){var n=e.addedNodes[t];(n.attributes&&n.attributes["data-item-type"]&&("assignment"==n.attributes["data-item-type"]||"1"==n.attributes["data-item-type"])||"function"==typeof n.querySelectorAll&&n.querySelectorAll("[data-item-type='assignment'], [data-item-type='1']").length>0)&&injectClassroomKamiAssignmentButton()}})}),injectClassroomKamiAssignmentButton=function(){create_assignment_divs=document.querySelectorAll('div[data-item-type="assignment"]:not([data-should-create-quiz="true"]), div[data-item-type="1"]:not([data-should-create-quiz="true"])'),create_assignment_divs.length>0?create_assignment_divs.forEach(function(e){if(!e.parentElement.parentElement.querySelector(".kami-create-assignment-button"))if(e.dataset.tooltip){var t=document.createElement("div");t.setAttribute("role","menuitem"),t.setAttribute("aria-label","Create Kami Assignment"),t.setAttribute("aria-disabled","false"),t.setAttribute("data-tooltip","Create Kami Assignment"),t.setAttribute("data-item-type","kami-assignment"),t.setAttribute("data-tooltip-position","left"),t.className="XHsn7e hCfBIe UISY8d-Tvm9db bFjUmb-Wvd9Cc kami-create-assignment-button",t.innerHTML=' <div class="HaXdpb"></div><div class="HRp7vf MbhUzd" jsname="ksKsZd"></div><content><content><div class="Ip8zfc" jsaction="JIbuQc:ObNs8b"><div class="kami-create-assignment-icon"></div></div></content></content>',e.parentElement.insertBefore(t,e);var n=document.createElement("span");e.parentElement.insertBefore(n,e.nextSibling),n.outerHTML='<span class="RM9ulf PgfOZ qs41qe" style="bottom: 181.5px;right: 94px;visibility: visible;transform-origin: 100% 50% 0px;transform: translate(0px, 0px);"><span class="R8qYlc"></span><span class="AZnilc">Create Kami assignment</span></span>',t.addEventListener("click",kamiCreateAssignmentButtonListener)}else{kami_button_html='<content class="z80M1 FeRvI kami-create-assignment-button" aria-label="Kami Assignment" role="menuitem" tabindex="-1" jsaction="mouseenter:SKyDAe; mouseleave:xq3APb;" jsname="j7LFlb">\n              <div class="PCdOIb Ce1Y1c" aria-hidden="true">\n                <span class="kami-create-assignment-new-icon" aria-hidden="true"></span>\n              </div>\n              <div class="uyYuVb oJeWuf" data-item-type="assignment">\n                <div class="jO7h3c">Kami assignment</div>\n              </div>\n            </content>';const t=document.createElement("div");t.innerHTML=kami_button_html;var i=t.children[0];t.removeChild(i),e.parentElement.parentElement.insertBefore(i,e.parentElement.nextSibling),i.addEventListener("click",kamiCreateAssignmentButtonListener)}}):fabMenuObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1})};injectClassroomKamiAssignmentButton(),document.body.addEventListener("click",function(e){var t=e.target.closest("a");if(t){var n=t.href;n&&(n.includes("https://drive.google.com/open")||n.includes("https://drive.google.com/file/d/")||n.includes("https://drive.google.com/document/d/"))&&(document.querySelector(".kami-drive-viewer-toolstrip-mid-panel")||previewOpenObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1})),n&&n.match(/https?:\/\/classroom\.google\.com.*\/c\/[A-z0-9]+/)&&setTimeout(function(){injectClassroomKamiAssignmentButton()},150)}});